{% extends "layout.html" %}
{% block content %}
<head>
  …
  <!-- alle 10 Sekunden die Seite neu laden -->
  <meta http-equiv="refresh" content="10">
  …
</head>
<h2>Offene Bestellungen – {{ waiter }}</h2>
<table class="table table-sm">
  <thead><tr><th>#</th><th>Details</th><th>Schank?</th><th>Aktion</th></tr></thead>
  <tbody>
    {% for o in orders if not o.bedienung_done %}
      <tr>
        <td>{{o.id}}</td>
        <td>
          {% for it in o.items %}
            {{it.qty}}× {{it.drink.name}} {{it.drink.size_ml}}ml<br>
          {% endfor %}
         <strong>Summe:</strong>
         {# Summenberechnung in zwei Schritten #}
         {% set total = 0 %}
         {% for it in o.items %}
         {% set total = total + (it.qty * it.drink.price) %}
         {% endfor %}
         {{ '%.2f'|format(total) }} €
        </td>
        <td>{{ '✔️' if o.schankwagen_done else '⏳' }}</td>
        <td>
          {% if o.schankwagen_done %}
            <form method="post" action="{{url_for('waiter_close', order_id=o.id)}}">
              <button class="btn btn-success btn-sm">Abgerechnet</button>
            </form>
          {% else %}—
          {% endif %}
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>
<a class="btn btn-secondary" href="{{url_for('order')}}">Neue Bestellung</a>
{% endblock %}
